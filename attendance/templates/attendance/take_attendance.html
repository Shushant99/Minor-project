{% extends 'base.html' %}
{% block content %}
<h2>Taking attendance for {{ session.classroom }} on {{ session.date }}</h2>
<img src="{% url 'attendance:video_feed' session.id %}" width="640" height="480">
<form method="post" action="{% url 'attendance:end_attendance' session.id %}">
    {% csrf_token %}
    <button type="submit">End Session</button>
</form>
<script>
async function refreshPresentList() {
    try {
        const res = await fetch("{% url 'attendance:session_status' session.id %}");
        const data = await res.json();
        const list = document.getElementById('present-list');
        list.innerHTML = '';
        data.present_students.forEach(s => {
            const li = document.createElement('li');
            li.textContent = s.roll_no + ' - ' + s.name;
            li.style.background = '#dcfce7';  // light green
            li.style.border = '1px solid #16a34a';
            li.style.borderRadius = '4px';
            li.style.padding = '4px 8px';
            li.style.marginBottom = '4px';
            list.appendChild(li);
        });
    } catch (e) {
        console.log(e);
    }
}

setInterval(refreshPresentList, 2000);  // every 2 seconds
refreshPresentList();
</script>
{% endblock %}

