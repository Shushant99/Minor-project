{% extends 'base.html' %}
{% block content %}
<div class="card">
  <h2 class="page-title">
    Taking attendance for {{ session.classroom.name }} on {{ session.date }}
  </h2>
  <p class="badge-muted">Green name = marked present in this session.</p>

  <div class="attendance-layout">
    <div>
      <div class="attendance-video">
        <img src="{% url 'attendance:video_feed' session.id %}" width="640" height="480">
      </div>
      <form method="post" action="{% url 'attendance:end_attendance' session.id %}" style="margin-top:12px;">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">End Session</button>
      </form>
    </div>

    <div class="attendance-side">
      <h3>Marked Present</h3>
      <ul id="present-list"></ul>
    </div>
  </div>
</div>

<script>
async function refreshPresentList() {
  try {
    const res = await fetch("{% url 'attendance:session_status' session.id %}");
    const data = await res.json();
    const list = document.getElementById('present-list');
    list.innerHTML = '';
    data.present_students.forEach(s => {
      const li = document.createElement('li');
      li.textContent = `${s.roll_no} - ${s.name}`;
      li.className = 'pill pill-present';
      list.appendChild(li);
    });
  } catch (e) {
    console.log(e);
  }
}
setInterval(refreshPresentList, 2000);
refreshPresentList();
</script>
{% endblock %}
